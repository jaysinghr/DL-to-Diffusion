# AUTOGENERATED! DO NOT EDIT! File to edit: ../nbs/05_minimalai-dataset-visualization.ipynb.

# %% ../nbs/05_minimalai-dataset-visualization.ipynb 3
from __future__ import annotations
import math
import numpy as np
import matplotlib.pyplot as plt
from operator import itemgetter
from itertools import zip_longest

import fastcore.all as fc

from torch.utils.data import default_collate

from .training import *

# %% auto 0
__all__ = ['apply_inplace_transformation', 'collate_dict']

# %% ../nbs/05_minimalai-dataset-visualization.ipynb 27
def apply_inplace_transformation(transform_function):
    '''
    Applies an in-place transformation to a batch of data.

    Args:
    - transform_function (function): A function that takes a batch of data as input and applies an in-place transformation to it.

    Returns:
    - function: A function that applies the in-place transformation to a batch of data and returns the transformed batch.
    '''
    def _apply_transformation_inplace(batch):
        '''
        Applies the provided in-place transformation to the batch of data.

        Args:
        - batch (dict): A dictionary containing the batched data.

        Returns:
        - dict: The batch of data after applying the in-place transformation.
        '''
        transform_function(batch)

        # Return the transformed batch
        return batch

    # Return the function that applies the in-place transformation
    return _apply_transformation_inplace


# %% ../nbs/05_minimalai-dataset-visualization.ipynb 38
def collate_dict(dataset):
    '''
    Collates a batch of data from a dataset.

    Args:
    - dataset: A dataset object.

    Returns:
    - function: A function that takes a batch of data as input and collates it based on the dataset's features.
    '''
    # Get the itemgetter function for the dataset's features
    get_features = itemgetter(*dataset.features)

    # Define the collate function for the dataset
    def _collate_batch(batch):
        '''
        Collates a batch of data based on the dataset's features.

        Args:
        - batch: A batch of data from the dataset.

        Returns:
        - dict: A dictionary containing the collated batch of data.
        '''
        # Collate the batch using the default_collate function and the itemgetter for the dataset's features
        return get_features(default_collate(batch))

    # Return the collate function
    return _collate_batch

